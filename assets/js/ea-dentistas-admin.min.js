document.addEventListener("DOMContentLoaded",function(){function n(d){if(listaEtapa1=document.getElementById("ea-dentista-lista-etapa-1")){var e=document.createElement("li"),e=(e.innerText="Etapa 1: apagar os dentistas que não existem mais na API.",listaEtapa1.append(e),document.createElement("li"));e.innerText="Executando Etapa 1...",listaEtapa1.append(e);const l=document.createElement("li"),i=(l.id="ea-dentistas-deleted-posts",listaEtapa1.append(l),document.createElement("li"));listaEtapa1.append(i);const c=new XMLHttpRequest;c.responseType="json",c.open("POST",ajax_object.ajax_url+"?action=ea_dentistas_delete_posts"),c.onload=function(){var e=c.response;if(200===c.status)if(e.success){console.log("response.deleted_posts",e.deleted_posts);e.deleted_posts;var t=e.deleted_posts?e.deleted_posts.length:0,a=(console.log("count",t),l.innerText=`Dentistas apagados (${t}).`,i.innerText="Etapa 1 concluída.",d);if(listaEtapa2=document.getElementById("ea-dentista-lista-etapa-2")){t=document.createElement("li"),t=(t.innerText="Etapa 2: cadastrar os novos dentistas.",listaEtapa2.append(t),document.createElement("li"));t.innerText="Executando Etapa 2...",listaEtapa2.append(t);const s=document.createElement("li"),n=(s.id="ea-dentistas-new-posts",listaEtapa2.append(s),document.createElement("li"));listaEtapa2.append(n);const o=new XMLHttpRequest;o.responseType="json",o.open("POST",ajax_object.ajax_url+"?action=ea_dentistas_register_new_posts"),o.onload=function(){var e=o.response;if(200===o.status)if(e.success){console.log("response.new_posts",e.new_posts);e.new_posts;var t=e.new_posts?e.new_posts.length:0,l=(console.log("count",t),s.innerText=`Novos dentistas cadastrados (${t}).`,n.innerText="Etapa 2 concluída.",a);if(listaEtapa3=document.getElementById("ea-dentista-lista-etapa-3")){t=document.createElement("li"),t=(t.innerText="Etapa 3: atualizar os dentistas existentes.",listaEtapa3.append(t),document.createElement("li"));t.innerText="Executando Etapa 3...",listaEtapa3.append(t);const i=document.createElement("li"),c=(i.id="ea-dentistas-existing-posts",listaEtapa3.append(i),document.createElement("li"));listaEtapa3.append(c);const p=new XMLHttpRequest;p.responseType="json",p.open("POST",ajax_object.ajax_url+"?action=ea_dentistas_update_existing_posts"),p.onload=function(){var e=p.response;if(200===p.status)if(e.success){console.log("response.updated_posts",e.updated_posts);e.updated_posts;var t=e.updated_posts?e.updated_posts.length:0,a=(console.log("count",t),i.innerText=`Dentistas atualizados (${t}).`,c.innerText="Etapa 3 concluída.",l);if(listaEtapa4=document.getElementById("ea-dentista-lista-etapa-4")){t=document.createElement("li"),t=(t.innerText="Etapa 4: atualizar a latitide e longitude dos dentistas.",listaEtapa4.append(t),document.createElement("li"));t.innerText="Executando Etapa 4...",listaEtapa4.append(t);const s=document.createElement("li"),n=(s.id="ea-dentistas-coordinates",listaEtapa4.append(s),document.createElement("li")),o=(listaEtapa4.append(n),document.createElement("li"));listaEtapa4.append(o);const d=new XMLHttpRequest;d.responseType="json",d.open("POST",ajax_object.ajax_url+"?action=ea_dentistas_update_addresses"),d.onload=function(){var e=d.response;if(200===d.status){if(!e.success)return console.log("success",e.success),console.log("msg",e.msg),s.innerText=e.msg,delete a.dataset.disabled,void(a.innerText="Atualizar dentistas");console.log("response.updated_posts",e.updated_posts);e.updated_posts;e=e.updated_posts?e.updated_posts.length:0;console.log("count",e),s.innerText=`Dentistas atualizados (${e}).`,n.innerText="Etapa 4 concluída.",o.innerText="Atualização concluída"}else s.innerText="Ocorreu um erro de conexão, tente novamente.",s.style.color="#ff0000";delete a.dataset.disabled,a.innerText="Atualizar dentistas"},d.send()}}else console.log("success",e.success),console.log("msg",e.msg),i.innerText=e.msg;else i.innerText="Ocorreu um erro de conexão, tente novamente.",listaItemUpdatedPosts.style.color="#ff0000",delete l.dataset.disabled,l.innerText="Atualizar dentistas"},p.send()}}else console.log("success",e.success),console.log("msg",e.msg),s.innerText=e.msg;else s.innerText="Ocorreu um erro de conexão, tente novamente.",listaItemUpdatedPosts.style.color="#ff0000",delete a.dataset.disabled,a.innerText="Atualizar dentistas"},o.send()}}else console.log("success",e.success),console.log("msg",e.msg),l.innerText=e.msg,delete d.dataset.disabled,d.innerText="Atualizar dentistas";else l.innerText="Ocorreu um erro de conexão, tente novamente.",listaItemUpdatedPosts.style.color="#ff0000",delete d.dataset.disabled,d.innerText="Atualizar dentistas"},c.send()}}{const o=document.getElementById("ea-dentistas-update-btn");if(o){const t=document.getElementById("ea-dentistas-update-html");t&&o.addEventListener("click",function(e){if(e.preventDefault(),o.dataset.disabled)console.log("Processando, aguarde");else{o.dataset.disabled=!0,o.innerText="Processando...",console.log("is_disabled 2",o.dataset.disabled),t.innerHTML="";const a=document.createElement("ul");a.id="ea-dentista-lista-etapa-1",t.append(a);e=document.createElement("ul"),e=(e.id="ea-dentista-lista-etapa-2",t.append(e),document.createElement("ul")),e=(e.id="ea-dentista-lista-etapa-3",t.append(e),document.createElement("ul")),e=(e.id="ea-dentista-lista-etapa-4",t.append(e),document.createElement("li"));e.innerText="Preparando atualização...",a.append(e);const s=new XMLHttpRequest;s.responseType="json",s.open("POST",ajax_object.ajax_url+"?action=ea_dentistas_start_update"),s.onload=function(){var e,t=s.response;200===s.status?t.success?n(o):((e=document.createElement("li")).innerText=t.msg,a.append(e)):((t=document.createElement("li")).innerText="Ocorreu um erro de conexão.",t.style.color="#ff0000",a.append(t),delete o.dataset.disabled,o.innerText="Atualizar dentistas")},s.send(),console.log("click")}})}}});