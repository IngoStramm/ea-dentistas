document.addEventListener("DOMContentLoaded",function(){function s(a){if(listaEtapa1=document.getElementById("ea-dentista-lista-etapa-1")){var e=document.createElement("li"),e=(e.innerText="Etapa 1: apagar os dentistas que não existem mais na API.",listaEtapa1.append(e),document.createElement("li"));e.innerText="Executando Etapa 1...",listaEtapa1.append(e);const n=document.createElement("li"),s=(n.id="ea-dentistas-deleted-posts",listaEtapa1.append(n),document.createElement("li"));listaEtapa1.append(s);const o=new XMLHttpRequest;o.responseType="json",o.open("POST",ajax_object.ajax_url+"?action=ea_dentistas_delete_posts"),o.onload=function(){var e=o.response;if(200===o.status)if(e.success){console.log("response.deleted_posts",e.deleted_posts);e.deleted_posts;var t=e.deleted_posts?e.deleted_posts.length:0,d=(console.log("count",t),n.innerText=`Dentistas apagados (${t}).`,s.innerText="Etapa 1 concluída.",a);if(listaEtapa2=document.getElementById("ea-dentista-lista-etapa-2")){t=document.createElement("li"),t=(t.innerText="Etapa 2: cadastrar os novos dentistas.",listaEtapa2.append(t),document.createElement("li"));t.innerText="Executando Etapa 2...",listaEtapa2.append(t);const l=document.createElement("li"),i=(l.id="ea-dentistas-new-posts",listaEtapa2.append(l),document.createElement("li"));listaEtapa2.append(i);const c=new XMLHttpRequest;c.responseType="json",c.open("POST",ajax_object.ajax_url+"?action=ea_dentistas_register_new_posts"),c.onload=function(){var e=c.response;if(200===c.status)if(e.success){console.log("response.new_posts",e.new_posts);e.new_posts;var t=e.new_posts?e.new_posts.length:0,a=(console.log("count",t),l.innerText=`Novos dentistas cadastrados (${t}).`,i.innerText="Etapa 2 concluída.",d);if(listaEtapa3=document.getElementById("ea-dentista-lista-etapa-3")){t=document.createElement("li"),t=(t.innerText="Etapa 3: atualizar os dentistas existentes.",listaEtapa3.append(t),document.createElement("li"));t.innerText="Executando Etapa 3...",listaEtapa3.append(t);const n=document.createElement("li"),s=(n.id="ea-dentistas-existing-posts",listaEtapa3.append(n),document.createElement("li"));listaEtapa3.append(s);const o=new XMLHttpRequest;o.responseType="json",o.open("POST",ajax_object.ajax_url+"?action=ea_dentistas_update_existing_posts"),o.onload=function(){var e,t=o.response;200===o.status?t.success?(console.log("response.updated_posts",t.updated_posts),t.updated_posts,e=t.updated_posts?t.updated_posts.length:0,console.log("count",e),n.innerText=`Dentistas atualizados (${e}).`,s.innerText="Etapa 3 concluída.",function n(s){console.log("iniciando ea_atualiza_coordenadas");listaEtapa4=document.getElementById("ea-dentista-lista-etapa-4");if(!listaEtapa4)return;const e=document.createElement("li");e.innerText="Etapa 4: atualizar a latitude e longitude dos dentistas.";listaEtapa4.append(e);const t=document.createElement("li");t.innerText="Executando Etapa 4...";listaEtapa4.append(t);const o=document.createElement("li");o.id="ea-dentistas-coordinates";listaEtapa4.append(o);const d=document.createElement("li");listaEtapa4.append(d);const l=document.createElement("li");listaEtapa4.append(l);const a="ea_dentistas_update_addresses";const i=new XMLHttpRequest;i.responseType="json";i.open("POST",ajax_object.ajax_url+"?action="+a);i.onload=function(){const e=i.response;if(200===i.status){if(null===typeof e.success||!e.success)return console.log("success",e.success),console.log("msg",e.msg),o.innerText=e.msg,delete s.dataset.disabled,void(s.innerText="Atualizar dentistas");console.log("response.updated_posts",e.updated_posts);e.updated_posts;const t=e.updated_posts?e.updated_posts.length:0;console.log("count",t),o.innerText=`Dentistas atualizados (${t}).`,d.innerText="Etapa 4 concluída.",l.innerText="Atualização concluída",l.style.color="#1ba71b",l.style.fontWeight="500"}else{let e=5,t="Ocorreu um erro de conexão, tentando novamente em 5 segundos...";o.innerText=t,o.style.color="#ff0000";const a=e=>{setTimeout(()=>{if(e<=0)return t="Retomando Etapa 4.",o.innerText=t,n(s);e--,o.innerText=t,a(e)},1e3)};a(5)}delete s.dataset.disabled,s.innerText="Atualizar dentistas"};i.send()}(a)):(console.log("success",t.success),console.log("msg",t.msg),n.innerText=t.msg):(n.innerText="Ocorreu um erro de conexão, tente novamente.",n.style.color="#ff0000",delete a.dataset.disabled,a.innerText="Atualizar dentistas")},o.send()}}else console.log("success",e.success),console.log("msg",e.msg),l.innerText=e.msg;else l.innerText="Ocorreu um erro de conexão, tente novamente.",l.style.color="#ff0000",delete d.dataset.disabled,d.innerText="Atualizar dentistas"},c.send()}}else console.log("success",e.success),console.log("msg",e.msg),n.innerText=e.msg,delete a.dataset.disabled,a.innerText="Atualizar dentistas";else n.innerText="Ocorreu um erro de conexão, tente novamente.",n.style.color="#ff0000",delete a.dataset.disabled,a.innerText="Atualizar dentistas"},o.send()}}{const o=document.getElementById("ea-dentistas-update-btn");if(o){const t=document.getElementById("ea-dentistas-update-html");t&&o.addEventListener("click",function(e){if(e.preventDefault(),o.dataset.disabled)console.log("Processando, aguarde");else{o.dataset.disabled=!0,o.innerText="Processando...",console.log("is_disabled 2",o.dataset.disabled),t.innerHTML="";const a=document.createElement("ul");a.id="ea-dentista-lista-etapa-1",t.append(a);e=document.createElement("ul"),e=(e.id="ea-dentista-lista-etapa-2",t.append(e),document.createElement("ul")),e=(e.id="ea-dentista-lista-etapa-3",t.append(e),document.createElement("ul")),e=(e.id="ea-dentista-lista-etapa-4",t.append(e),document.createElement("li"));e.innerText="Preparando atualização...",a.append(e);const n=new XMLHttpRequest;n.responseType="json",n.open("POST",ajax_object.ajax_url+"?action=ea_dentistas_start_update"),n.onload=function(){var e,t=n.response;200===n.status?t.success?s(o):((e=document.createElement("li")).innerText=t.msg,a.append(e)):((t=document.createElement("li")).innerText="Ocorreu um erro de conexão, tente novamente",t.style.color="#ff0000",a.append(t),delete o.dataset.disabled,o.innerText="Atualizar dentistas")},n.send(),console.log("click")}})}}});